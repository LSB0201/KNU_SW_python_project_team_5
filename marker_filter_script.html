{% macro html(this, kwargs) %}
<script>
  const markers = __MARKER_DATA__;
  let mapMarkers = [];

  const cityCenters = {
    ê²½ì‚°ì‹œ: [35.825, 128.74],
    ê²½ì£¼ì‹œ: [35.856, 129.224],
    êµ¬ë¯¸ì‹œ: [36.12, 128.344],
    ê¹€ì²œì‹œ: [36.139, 128.113],
    ë¬¸ê²½ì‹œ: [36.594, 128.188],
    ìƒì£¼ì‹œ: [36.411, 128.158],
    ì•ˆë™ì‹œ: [36.568, 128.729],
    ì˜ì£¼ì‹œ: [36.805, 128.623],
    ì˜ì²œì‹œ: [35.973, 128.94],
    í¬í•­ì‹œ: [36.019, 129.343],
    ì˜ì„±êµ°: [36.354, 128.697],
    ì¹ ê³¡êµ°: [35.995, 128.41],
    ì²­ì†¡êµ°: [36.435, 129.056],
  };

  function showMarkers(cityName) {
    mapMarkers.forEach((m) => __MAP__.removeLayer(m));
    mapMarkers = [];

    const filtered =
      cityName === "ì „ì²´" || cityName === ""
        ? markers
        : markers.filter((data) => data.address.includes(cityName));

    filtered.forEach((data) => {
      const icon = L.divIcon({
        className: "",
        html: `<div style="
          background-color: white;
          border: 2px solid red;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          text-align: center;
          line-height: 40px;
          font-size: 22px;
          box-shadow: 1px 1px 5px rgba(255,0,0,0.5);
          user-select: none;
          pointer-events: auto;
          display: flex;
          align-items: center;
          justify-content: center;
        ">ğŸ”¥</div>`,
      });

      const marker = L.marker([data.lat, data.lng], { icon: icon })
        .addTo(__MAP__)
        .bindPopup(`ğŸ”¥ í™”ì¬ ë°œìƒ: ${data.address}<br>ğŸ•’ ${data.time}`);
      mapMarkers.push(marker);
    });

    if (cityName && cityCenters[cityName]) {
      __MAP__.setView(cityCenters[cityName], 11);
    } else {
      __MAP__.setView([35.4, 128.2], 8.3);
    }
  }

  document
    .getElementById("citySelect")
    .addEventListener("change", function (e) {
      const selected = e.target.value;
      showMarkers(selected);
    });

  showMarkers("");
</script>
{% endmacro %}
